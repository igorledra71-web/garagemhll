<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Garagem HL - Est√©tica Automotiva</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:#0b0b0b;
  color:#fff;
  font-family:'Poppins',Arial,sans-serif;
  min-height:100vh;
}

/* TELAS */
section{display:none;min-height:100vh;padding:30px 20px 140px}
#home{display:block}

/* CONTAINER */
.app-container{max-width:480px;margin:auto;text-align:center}

/* LOGO */
.logo-container{margin:20px auto}
.logo-container img{width:100%;max-width:380px;display:block;margin:auto}
.slogan{color:#d4af37;letter-spacing:2px;font-size:14px}

/* BOT√ïES PRINCIPAIS */
.main-btn{
  width:100%;
  padding:18px;
  margin:16px 0;
  border:none;
  border-radius:16px;
  font-size:17px;
  font-weight:600;
  background:linear-gradient(135deg,#00b4ff,#0077ff);
  color:#fff;
  box-shadow:0 6px 18px rgba(0,180,255,0.3);
}

/* BOT√ÉO ALTERNATIVO */
.alt-btn{
  width:100%;
  padding:16px;
  margin:14px 0;
  border-radius:16px;
  background:transparent;
  border:2px solid #00b4ff;
  color:#00b4ff;
  font-weight:600;
}

/* VOLTAR */
.back{
  display:inline-block;
  margin-bottom:20px;
  color:#d4af37;
  font-size:15px;
  cursor:pointer;
}

/* INPUTS */
input,select{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  margin-top:10px;
}

/* CARDS */
.card{
  background:linear-gradient(180deg,#141414,#0f0f0f);
  border:1px solid #1f1f1f;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  text-align:left;
}

/* BOT√ïES PEQUENOS */
.small-btn{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-weight:600;
  background:linear-gradient(135deg,#00b4ff,#0077ff);
  color:#fff;
  margin-top:10px;
}
.small-btn.red{background:linear-gradient(135deg,#ff4d4d,#c70000)}
.small-btn.gray{background:#333}

/* SEARCH ADMIN */
.search-input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  margin-top:30px;
}
</style>
</head>
<body>

<!-- HOME -->
<section id="home">
  <div class="app-container">
    <div class="logo-container">
      <img src="logo-garagem-hl.png" alt="Garagem HL">
    </div>
    <div class="slogan">EST√âTICA AUTOMOTIVA</div>

    <button class="main-btn" onclick="abrirAgendamento()">üìÖ AGENDAR HOR√ÅRIO</button>

    <input id="buscaAdmin" class="search-input" type="text" placeholder="Pesquisar..." oninput="verificarAdmin()">
  </div>
</section>

<!-- AGENDAMENTO CLIENTE -->
<section id="agendamento">
  <span class="back" onclick="voltarHome()">‚¨Ö Voltar</span>
  <div class="app-container">
    <h2 style="color:#d4af37;margin-bottom:20px">Hor√°rios Dispon√≠veis</h2>
    <div id="calendario"></div>
  </div>
</section>

<!-- ADMIN -->
<section id="admin">
  <span class="back" onclick="voltarHome()">‚¨Ö Voltar</span>

  <div class="app-container">
    <h2 style="color:#d4af37;margin-bottom:20px">Painel Administrativo</h2>

    <button class="main-btn" onclick="abrirBloco('blocoDatas')">üìÖ Definir Datas e Hor√°rios</button>
    <button class="main-btn" onclick="abrirBloco('blocoLimites')">üî¢ Definir Limite por Dia</button>
    <button class="main-btn" onclick="abrirBloco('blocoReservas')">üëÄ Ver Reservas</button>
    <button class="main-btn" onclick="abrirBloco('blocoHistorico')">üìú Hist√≥rico</button>
    <button class="main-btn" onclick="resetarAgenda()">‚ôª Resetar Agenda</button>

    <!-- BLOCO: DATAS -->
    <div id="blocoDatas" style="display:none">
      <div class="card">
        <h3>Adicionar Data e Hor√°rios</h3>
        <input type="date" id="dataNova">
        <input type="text" id="horariosNovos" placeholder="Ex: 09:00,10:30,14:00">
        <button class="small-btn" onclick="salvarDataHorarios()">Salvar</button>
      </div>
    </div>

    <!-- BLOCO: LIMITES -->
    <div id="blocoLimites" style="display:none"></div>

    <!-- BLOCO: RESERVAS -->
    <div id="blocoReservas" style="display:none"></div>

    <!-- BLOCO: HIST√ìRICO -->
    <div id="blocoHistorico" style="display:none"></div>

  </div>
</section>
<script>
const SENHA_ADMIN = "1234";

/* ===== NAVEGA√á√ÉO ===== */
function mostrar(id){
  ["home","agendamento","admin"].forEach(s=>{
    document.getElementById(s).style.display="none";
  });
  document.getElementById(id).style.display="block";
}

function abrirAgendamento(){
  mostrar("agendamento");
  carregarDatas();
}

function voltarHome(){
  mostrar("home");
}

/* ===== ADMIN VIA BUSCA ===== */
function verificarAdmin(){
  const v = document.getElementById("buscaAdmin").value.toLowerCase();
  if(v === "admin"){
    const senha = prompt("Digite a senha de administrador:");
    document.getElementById("buscaAdmin").value = "";
    if(senha === SENHA_ADMIN){
      mostrar("admin");
      carregarLimites();
      carregarReservas();
      carregarHistorico();
    } else {
      alert("Senha incorreta");
    }
  }
}

/* ===== CONTROLE DE BLOCOS ===== */
function abrirBloco(id){
  ["blocoDatas","blocoLimites","blocoReservas","blocoHistorico"].forEach(b=>{
    document.getElementById(b).style.display="none";
  });
  document.getElementById(id).style.display="block";
}
</script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAgpXloiKBrnRHMBTz8UM1PA3Q9oSYiqU4",
  authDomain: "garagem-hl.firebaseapp.com",
  databaseURL: "https://garagem-hl-default-rtdb.firebaseio.com",
  projectId: "garagem-hl",
  storageBucket: "garagem-hl.firebasestorage.app",
  messagingSenderId: "1050652036484",
  appId: "1:1050652036484:web:3a053bcbbc610038a921d1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== CLIENTE ===== */
function formatarData(data){
  const p = data.split("-");
  return p[2]+"/"+p[1]+"/"+p[0];
}

function carregarDatas(){
  db.ref("datas_disponiveis").on("value", snap=>{
    const dados = snap.val();
    let html = "";

    if(dados){
      for(let data in dados){
        const dia = dados[data];
        const reservas = dia.reservas || {};
        const horarios = dia.horarios || [];

        html += `<div class="card"><strong>${formatarData(data)}</strong><br>`;

        horarios.forEach(h=>{
          if(!reservas[h]){
            html += `<button class="small-btn" onclick="reservar('${data}','${h}')">${h}</button> `;
          }
        });

        html += `</div>`;
      }
    }

    if(html==="") html = "<p style='color:#aaa;text-align:center'>Nenhum hor√°rio dispon√≠vel</p>";
    document.getElementById("calendario").innerHTML = html;
  });
}

function reservar(data,hora){
  const nome = prompt("Digite seu nome:");
  if(!nome) return;

  if(confirm(`Confirmar ${formatarData(data)} √†s ${hora}?`)){
    db.ref(`datas_disponiveis/${data}/reservas/${hora}`).set({cliente:nome});
    db.ref(`historico/${data}_${hora}`).set({cliente:nome,data:data,hora:hora});

    const msg = `Ol√°, agendei na Garagem HL üöó%0AData: ${formatarData(data)}%0AHora: ${hora}%0ANome: ${nome}`;
    window.open("https://wa.me/5549999741891?text="+msg,"_blank");

    alert("Agendamento confirmado!");
  }
}

/* ===== ADMIN - DATAS ===== */
function salvarDataHorarios(){
  const data = document.getElementById("dataNova").value;
  const horarios = document.getElementById("horariosNovos").value;

  if(!data || !horarios){
    alert("Preencha a data e os hor√°rios");
    return;
  }

  const arr = horarios.split(",").map(h=>h.trim());

  db.ref("datas_disponiveis/"+data).set({
    horarios: arr,
    reservas: {}
  });

  alert("Data e hor√°rios salvos!");
  document.getElementById("dataNova").value="";
  document.getElementById("horariosNovos").value="";
}

/* ===== ADMIN - LIMITES ===== */
function carregarLimites(){
  db.ref("datas_disponiveis").on("value", snap=>{
    const dados = snap.val();
    let html = "<h3>Limite por Dia</h3>";

    if(dados){
      for(let data in dados){
        const limite = dados[data].limite || 0;
        html += `
          <div class="card">
            ${formatarData(data)}<br>
            Limite atual: ${limite}<br>
            <button class="small-btn" onclick="definirLimite('${data}')">Alterar Limite</button>
          </div>
        `;
      }
    }

    document.getElementById("blocoLimites").innerHTML = html;
  });
}

function definirLimite(data){
  const novo = prompt("Novo limite de vagas:");
  if(novo){
    db.ref("datas_disponiveis/"+data).update({limite:parseInt(novo)});
  }
}

/* ===== ADMIN - RESERVAS ===== */
function carregarReservas(){
  db.ref("datas_disponiveis").on("value", snap=>{
    const dados = snap.val();
    let html = "<h3>Reservas</h3>";

    if(dados){
      for(let data in dados){
        const reservas = dados[data].reservas || {};
        for(let hora in reservas){
          html += `
            <div class="card">
              ${formatarData(data)} ${hora} - ${reservas[hora].cliente}
              <button class="small-btn red" onclick="liberar('${data}','${hora}')">Liberar</button>
            </div>
          `;
        }
      }
    }

    document.getElementById("blocoReservas").innerHTML = html;
  });
}

function liberar(data,hora){
  db.ref(`datas_disponiveis/${data}/reservas/${hora}`).remove();
}

/* ===== ADMIN - HIST√ìRICO ===== */
function carregarHistorico(){
  db.ref("historico").on("value", snap=>{
    const dados = snap.val();
    let html = "<h3>Hist√≥rico</h3>";

    if(dados){
      for(let id in dados){
        const r = dados[id];
        html += `<div class="card">${formatarData(r.data)} ${r.hora} - ${r.cliente}</div>`;
      }
    }

    document.getElementById("blocoHistorico").innerHTML = html;
  });
}

/* ===== RESET ===== */
function resetarAgenda(){
  if(confirm("Tem certeza que deseja apagar toda a agenda?")){
    db.ref("datas_disponiveis").remove();
    db.ref("historico").remove();
    alert("Agenda resetada!");
  }
}
</script>

</body>
</html>
